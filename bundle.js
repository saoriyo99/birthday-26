(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,a=0;a<t.length;a++)if(t[a].identifier===e){n=a;break}return n}function a(e,a){for(var r={},o=[],s=0;s<e.length;s++){var l=e[s],c=a.base?l[0]+a.base:l[0],d=r[c]||0,p="".concat(c," ").concat(d);r[c]=d+1;var h=n(p),g={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(g);else{var m=i(g,a);a.byIndex=s,t.splice(s,0,{identifier:p,updater:m,references:1})}o.push(p)}return o}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var r=a(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<r.length;o++){var s=n(r[o]);t[s].references--}for(var l=a(e,i),c=0;c<r.length;c++){var d=n(r[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=l}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},208:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(601),i=n.n(a),r=n(314),o=n.n(r)()(i());o.push([e.id,"* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: 'Courier New', monospace;\n    background: linear-gradient(135deg, #1a1a2e, #16213e);\n    color: #00ff41;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    min-height: 100vh;\n    padding: 10px;\n}\n\n.game-container {\n    background: rgba(0, 0, 0, 0.9);\n    border-radius: 15px;\n    padding: 20px;\n    box-shadow: 0 15px 35px rgba(0, 255, 65, 0.3);\n    border: 2px solid #00ff41;\n}\n\n.story-header {\n    text-align: center;\n    margin-bottom: 15px;\n    padding: 10px;\n    background: rgba(0, 255, 65, 0.1);\n    border-radius: 10px;\n    font-size: 14px;\n}\n\n.game-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 15px;\n    padding: 10px 15px;\n    background: rgba(0, 255, 65, 0.1);\n    border-radius: 10px;\n}\n\n.stat {\n    text-align: center;\n}\n\n.stat-value {\n    font-size: 20px;\n    font-weight: bold;\n    color: #00ff41;\n}\n\n.stat-value.critical {\n    color: #ff4757;\n    animation: pulse 1s infinite;\n}\n\n@keyframes pulse {\n\n    0%,\n    100% {\n        opacity: 1;\n    }\n\n    50% {\n        opacity: 0.5;\n    }\n}\n\n.stat-label {\n    font-size: 10px;\n    opacity: 0.8;\n}\n\n.progress-bar {\n    width: 100%;\n    height: 20px;\n    background: rgba(0, 0, 0, 0.5);\n    border-radius: 10px;\n    margin: 5px 0;\n    border: 1px solid #00ff41;\n}\n\n.progress-fill {\n    height: 100%;\n    background: linear-gradient(90deg, #00ff41, #00aa2e);\n    border-radius: 10px;\n    transition: width 0.3s ease;\n}\n\n#gameCanvas {\n    border: 3px solid #00ff41;\n    border-radius: 10px;\n    background: #0a0a0a;\n    cursor: crosshair;\n    display: block;\n}\n\n.controls {\n    margin-top: 15px;\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\n    gap: 8px;\n}\n\n.friend-btn {\n    padding: 8px 12px;\n    background: linear-gradient(45deg, #ff6b6b, #ee5a24);\n    border: none;\n    border-radius: 8px;\n    color: white;\n    cursor: pointer;\n    font-weight: bold;\n    font-size: 10px;\n    transition: all 0.3s ease;\n    border: 1px solid transparent;\n    position: relative;\n}\n\n.friend-btn:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);\n    border-color: #00ff41;\n}\n\n.friend-btn:disabled {\n    background: #333;\n    cursor: not-allowed;\n    transform: none;\n    opacity: 0.5;\n    filter: grayscale(1);\n}\n\n.friend-btn.selected {\n    border-color: #00ff41;\n    box-shadow: 0 0 10px rgba(0, 255, 65, 0.5);\n}\n\n/* Color coordination for friend types */\n.friend-btn.nerd-specialist {\n    background: linear-gradient(45deg, #9C27B0, #673AB7);\n}\n\n.friend-btn.nature-specialist {\n    background: linear-gradient(45deg, #4CAF50, #388E3C);\n}\n\n.friend-btn.professional-counter {\n    background: linear-gradient(45deg, #FF9800, #F57C00);\n}\n\n.friend-btn.speed-specialist {\n    background: linear-gradient(45deg, #00BCD4, #0097A7);\n}\n\n.friend-btn.charm-specialist {\n    background: linear-gradient(45deg, #E91E63, #C2185B);\n}\n\n.friend-btn.support-specialist {\n    background: linear-gradient(45deg, #FF9800, #F57C00);\n}\n\n.friend-btn.scholar-specialist {\n    background: linear-gradient(45deg, #3F51B5, #303F9F);\n}\n\n.friend-btn.musical-specialist {\n    background: linear-gradient(45deg, #FF6B9D, #E91E63);\n}\n\n.friend-btn.grappler-specialist {\n    background: linear-gradient(45deg, #795548, #5D4037);\n}\n\n.upgrade-indicator {\n    position: absolute;\n    top: -5px;\n    right: -5px;\n    background: gold;\n    color: black;\n    border-radius: 50%;\n    width: 15px;\n    height: 15px;\n    font-size: 8px;\n    display: none;\n    align-items: center;\n    justify-content: center;\n}\n\n.game-btn {\n    padding: 12px 20px;\n    background: linear-gradient(45deg, #00ff41, #00aa2e);\n    border: none;\n    border-radius: 8px;\n    color: black;\n    cursor: pointer;\n    font-weight: bold;\n    transition: all 0.3s ease;\n    margin-top: 10px;\n}\n\n.game-btn:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 5px 15px rgba(0, 255, 65, 0.4);\n}\n\n.game-btn:disabled {\n    background: #666;\n    cursor: not-allowed;\n    transform: none;\n}\n\n.speed-btn {\n    padding: 8px 15px;\n    background: linear-gradient(45deg, #FFC107, #FF8F00);\n    border: none;\n    border-radius: 8px;\n    color: black;\n    cursor: pointer;\n    font-weight: bold;\n    font-size: 12px;\n    margin-left: 10px;\n}\n\n.speed-btn.fast {\n    background: linear-gradient(45deg, #FF5722, #D84315);\n    color: white;\n}\n\n.codex-btn {\n    padding: 8px 15px;\n    background: linear-gradient(45deg, #9C27B0, #673AB7);\n    border: none;\n    border-radius: 8px;\n    color: white;\n    cursor: pointer;\n    font-weight: bold;\n    font-size: 12px;\n    margin-left: 10px;\n}\n\n.wave-info {\n    text-align: center;\n    margin-top: 10px;\n    padding: 8px;\n    background: rgba(0, 255, 65, 0.1);\n    border-radius: 8px;\n    font-size: 12px;\n}\n\n.modal {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.8);\n    display: none;\n    justify-content: center;\n    align-items: center;\n    z-index: 1000;\n}\n\n.modal-content {\n    background: linear-gradient(135deg, #1a1a2e, #16213e);\n    color: #00ff41;\n    padding: 30px;\n    border-radius: 15px;\n    text-align: center;\n    border: 2px solid #00ff41;\n    max-width: 400px;\n    max-height: 80vh;\n    overflow-y: auto;\n}\n\n.upgrade-modal {\n    max-width: 500px;\n}\n\n.codex-modal {\n    max-width: 600px;\n    text-align: left;\n}\n\n.game-over-modal {\n    max-width: 450px;\n}\n\n.upgrade-options {\n    display: flex;\n    gap: 15px;\n    margin: 20px 0;\n    justify-content: center;\n    flex-wrap: wrap;\n}\n\n.upgrade-btn {\n    padding: 15px;\n    background: linear-gradient(45deg, #9C27B0, #673AB7);\n    border: none;\n    border-radius: 10px;\n    color: white;\n    cursor: pointer;\n    font-weight: bold;\n    transition: all 0.3s ease;\n    font-size: 12px;\n}\n\n.upgrade-btn:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 5px 15px rgba(156, 39, 176, 0.4);\n}\n\n.upgrade-btn:disabled {\n    background: #666;\n    cursor: not-allowed;\n}\n\n.notification {\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background: linear-gradient(135deg, #00ff41, #00aa2e);\n    color: black;\n    padding: 20px;\n    border-radius: 10px;\n    font-weight: bold;\n    z-index: 1001;\n    display: none;\n}\n\n.enemy-preview {\n    display: flex;\n    justify-content: center;\n    gap: 10px;\n    margin: 15px 0;\n    flex-wrap: wrap;\n}\n\n.enemy-icon {\n    display: inline-block;\n    width: 30px;\n    height: 30px;\n    border-radius: 5px;\n    text-align: center;\n    line-height: 30px;\n    font-size: 12px;\n    color: white;\n    font-weight: bold;\n    position: relative;\n}\n\n.codex-section {\n    margin: 20px 0;\n    padding: 15px;\n    background: rgba(0, 255, 65, 0.1);\n    border-radius: 10px;\n}\n\n.codex-item {\n    display: flex;\n    align-items: center;\n    margin: 10px 0;\n    padding: 10px;\n    background: rgba(0, 0, 0, 0.3);\n    border-radius: 5px;\n}\n\n.codex-icon {\n    width: 40px;\n    height: 40px;\n    margin-right: 15px;\n    border-radius: 5px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-weight: bold;\n}\n\n.cancel-text {\n    position: fixed;\n    bottom: 20px;\n    left: 50%;\n    transform: translateX(-50%);\n    background: rgba(0, 0, 0, 0.8);\n    color: #00ff41;\n    padding: 10px 20px;\n    border-radius: 10px;\n    font-size: 12px;\n}\n\n.storyline-modal {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.95);\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    z-index: 2000;\n}\n\n.storyline-content {\n    background: linear-gradient(135deg, #1a1a2e, #16213e);\n    color: #00ff41;\n    padding: 40px;\n    border-radius: 20px;\n    text-align: center;\n    border: 3px solid #00ff41;\n    max-width: 500px;\n    max-height: 600px;\n    overflow-y: auto;\n    font-size: 16px;\n    line-height: 1.6;\n}\n\n.upgrade-btn.selected {\n    background: linear-gradient(45deg, #4CAF50, #388E3C);\n    border: 2px solid #00ff41;\n}\n\n.upgrade-btn.unavailable {\n    background: #333;\n    opacity: 0.5;\n    filter: grayscale(1);\n    cursor: not-allowed;\n}\n",""]);const s=o},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",a=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),a&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),a&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,a,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(a)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);a&&o[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var a=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var a="";n.supports&&(a+="@supports (".concat(n.supports,") {")),n.media&&(a+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(a+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),a+=n.css,i&&(a+="}"),n.media&&(a+="}"),n.supports&&(a+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(a,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(a){var i=t[a];if(void 0!==i)return i.exports;var r=t[a]={id:a,exports:{}};return e[a](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;var a=n(72),i=n.n(a),r=n(825),o=n.n(r),s=n(659),l=n.n(s),c=n(56),d=n.n(c),p=n(540),h=n.n(p),g=n(113),m=n.n(g),u=n(208),f={};f.styleTagTransform=m(),f.setAttributes=d(),f.insert=l().bind(null,"head"),f.domAPI=o(),f.insertStyleElement=h(),i()(u.A,f),u.A&&u.A.locals&&u.A.locals;var y=[{name:"Local Dev Environment",desc:"Simple setup - just you and your code",difficulty:"⭐",theme:"Setting up the basic development environment",paths:[[{x:0,y:300},{x:150,y:300},{x:150,y:150},{x:350,y:150},{x:350,y:450},{x:550,y:450},{x:550,y:250},{x:700,y:250},{x:750,y:250}]],spawns:[{x:0,y:300,pathIndex:0}]},{name:"Function Library",desc:"Building reusable functions - two ways in",difficulty:"⭐⭐",theme:"Writing modular, reusable code functions",paths:[[{x:0,y:200},{x:200,y:200},{x:200,y:300},{x:400,y:300},{x:400,y:400},{x:600,y:400},{x:750,y:250}],[{x:0,y:400},{x:150,y:400},{x:150,y:300},{x:400,y:300},{x:400,y:400},{x:600,y:400},{x:750,y:250}]],spawns:[{x:0,y:200,pathIndex:0},{x:0,y:400,pathIndex:1}]},{name:"API Integration",desc:"Connecting to external services - three endpoints",difficulty:"⭐⭐⭐",theme:"Integrating with third-party APIs and services",paths:[[{x:0,y:150},{x:250,y:150},{x:250,y:250},{x:500,y:250},{x:750,y:250}],[{x:0,y:300},{x:200,y:300},{x:200,y:250},{x:500,y:250},{x:750,y:250}],[{x:0,y:450},{x:300,y:450},{x:300,y:350},{x:500,y:350},{x:500,y:250},{x:750,y:250}]],spawns:[{x:0,y:150,pathIndex:0},{x:0,y:300,pathIndex:1},{x:0,y:450,pathIndex:2}]},{name:"Testing Suite",desc:"Comprehensive testing - bugs everywhere!",difficulty:"⭐⭐⭐⭐",theme:"Writing unit tests, integration tests, and debugging",paths:[[{x:0,y:100},{x:150,y:100},{x:150,y:200},{x:300,y:200},{x:300,y:300},{x:600,y:300},{x:750,y:250}],[{x:0,y:300},{x:100,y:300},{x:100,y:400},{x:250,y:400},{x:250,y:300},{x:600,y:300},{x:750,y:250}],[{x:0,y:500},{x:200,y:500},{x:200,y:350},{x:400,y:350},{x:400,y:300},{x:600,y:300},{x:750,y:250}]],spawns:[{x:0,y:100,pathIndex:0},{x:0,y:300,pathIndex:1},{x:0,y:500,pathIndex:2}]},{name:"Production Deployment",desc:"Going live - maximum chaos!",difficulty:"⭐⭐⭐⭐⭐",theme:"Deploying to production and handling real users",paths:[[{x:0,y:80},{x:120,y:80},{x:120,y:180},{x:300,y:180},{x:300,y:280},{x:650,y:280},{x:750,y:250}],[{x:0,y:220},{x:180,y:220},{x:180,y:280},{x:650,y:280},{x:750,y:250}],[{x:0,y:380},{x:150,y:380},{x:150,y:320},{x:450,y:320},{x:450,y:280},{x:650,y:280},{x:750,y:250}],[{x:0,y:520},{x:250,y:520},{x:250,y:420},{x:500,y:420},{x:500,y:320},{x:450,y:320},{x:450,y:280},{x:650,y:280},{x:750,y:250}]],spawns:[{x:0,y:80,pathIndex:0},{x:0,y:220,pathIndex:1},{x:0,y:380,pathIndex:2},{x:0,y:520,pathIndex:3}]}],x={dario:{cost:50,damage:15,range:100,fireRate:1e3,color:"#FF9800",special:"family_photo",strong:[],weak:[],upgrades:["damage","rate","range"],desc:"Family photo master! Click for group photo (pauses all enemies 3s, once per wave).",category:"professional-counter"},tony:{cost:120,damage:22,range:110,fireRate:1200,color:"#9C27B0",special:"moveable",strong:["intern","coworker"],weak:["boss","karen","networker"],upgrades:["slow","damage","nerd_boost"],desc:'Star Wars specialist! "Hey I\'m coming to visit" - can move once per wave.',category:"star-wars-specialist"},sophia:{cost:180,damage:16,range:150,fireRate:600,color:"#FF9800",special:"listener",strong:["oversharer","elderly"],weak:["intern","performer"],upgrades:["heal","range","empathy"],desc:"Premium support specialist. Heals and boosts nearby friends.",category:"support-specialist"},max:{cost:160,damage:45,range:130,fireRate:2e3,color:"#E91E63",special:"music_single",strong:["performer","gymguy"],weak:["boss","karen","uncle"],upgrades:["wide","damage","bass"],desc:"Slow but devastating single-target music specialist.",category:"charm-specialist"},junior:{cost:90,damage:18,range:220,fireRate:800,color:"#4CAF50",special:"trivia_range",strong:["elderly","uncle","bartender"],weak:["intern","performer"],upgrades:["range","trivia","boring"],desc:"Long-range trivia bombardment. Elderly love his stories.",category:"nature-specialist"},sao:{cost:140,damage:0,range:130,fireRate:600,color:"#00BCD4",special:"slow_only",strong:["intern","performer","elevator"],weak:["boss","karen"],upgrades:["slow","damage","freeze"],desc:"Pure slowdown specialist. Needs damage upgrade to attack.",category:"speed-specialist"},po:{cost:110,damage:0,range:140,fireRate:800,color:"#9C27B0",special:"conspiracy_only",strong:["neighbor","uber","clerk"],weak:["boss","networker","karen"],upgrades:["conspiracy","damage","convert"],desc:"Conspiracy slowdown specialist. Needs damage upgrade to attack.",category:"nerd-specialist"},wrenly:{cost:170,damage:28,range:150,fireRate:900,color:"#E91E63",special:"cuteness_wide",strong:["neighbor","clerk","uber","elderly"],weak:["boss","karen"],upgrades:["cute","wide","charm"],desc:"Premium cuteness specialist with AOE charm.",category:"charm-specialist"},drea:{cost:65,damage:8,range:90,fireRate:250,color:"#00BCD4",special:"fasttalk",strong:["neighbor","clerk"],weak:["boss","uncle","bartender"],upgrades:["speed","damage","caffeine"],desc:"Speed talker with rapid-fire low damage. Great vs weak enemies.",category:"speed-specialist"},ruel:{cost:130,damage:35,range:120,fireRate:1400,color:"#4CAF50",special:"train_rampage",strong:["bartender","elderly"],weak:["intern","performer"],upgrades:["damage","boring","trains"],desc:"Premium train specialist. Click for TRAIN RAMPAGE! (once per wave)",category:"nature-specialist"},nicole:{cost:125,damage:24,range:200,fireRate:700,color:"#4CAF50",special:"flowers_range",strong:["elderly","neighbor","karen"],weak:["boss","networker"],upgrades:["range","nature","calming"],desc:"Premium long-range flower wisdom specialist.",category:"nature-specialist"},maddie:{cost:95,damage:12,range:120,fireRate:900,color:"#3F51B5",special:"student_experience",strong:["intern","clerk"],weak:["boss","uncle","bartender"],upgrades:["study","experience","wisdom"],desc:"Student who gets stronger over time. Learns from every interaction!",category:"scholar-specialist",experienceLevel:0,maxExperience:10},aviva:{cost:140,damage:20,range:140,fireRate:1100,color:"#FF6B9D",special:"singing_stun",strong:["performer","elderly","neighbor"],weak:["boss","networker"],upgrades:["harmony","volume","repertoire"],desc:"Beautiful singing voice that mesmerizes and stuns nearby enemies.",category:"musical-specialist"},oise:{cost:105,damage:30,range:80,fireRate:1300,color:"#795548",special:"grapple_close",strong:["gymguy","performer","elevator"],weak:["elderly","networker"],upgrades:["strength","grapple","listening"],desc:"Great listener who can wrestle down enemies when things get intense.",category:"grappler-specialist"}},v={neighbor:{health:30,speed:1,reward:10,socialDamage:1,color:"#FFE082",name:"Chatty Neighbor",icon:"🏠",desc:"Wants to talk about the weather and property values.",category:"gullible"},clerk:{health:25,speed:1.2,reward:8,socialDamage:1,color:"#A5D6A7",name:"Retail Clerk",icon:"🛍️",desc:"Did you find everything you need today?",category:"gullible"},uber:{health:35,speed:.8,reward:12,socialDamage:1,color:"#90CAF9",name:"Uber Driver",icon:"🚗",desc:"Trapped audience who wants to share life philosophy.",category:"gullible"},performer:{health:40,speed:1.8,reward:18,socialDamage:1.5,color:"#CE93D8",name:"Street Performer",icon:"🎭",desc:"High energy entertainer demanding audience participation.",category:"energetic"},elderly:{health:50,speed:.6,reward:22,socialDamage:1.5,color:"#BCAAA4",name:"Elderly Storyteller",icon:"👴",desc:'Has many stories from "back in my day".',category:"patient"},gymguy:{health:55,speed:1.4,reward:20,socialDamage:1.5,color:"#FFAB91",name:"Gym Regular",icon:"💪",desc:"Wants to discuss your workout routine and protein intake.",category:"energetic"},boss:{health:80,speed:.9,reward:28,socialDamage:2.5,color:"#F48FB1",name:"Boss",icon:"💼",desc:"Needs to circle back and touch base about synergies.",category:"professional"},evangelist:{health:70,speed:1.1,reward:26,socialDamage:2,color:"#FFF176",name:"Evangelist",icon:"📖",desc:"Very persistent about sharing good news.",category:"persistent"},oversharer:{health:60,speed:1.2,reward:22,socialDamage:2,color:"#FFAB91",name:"Oversharer",icon:"😭",desc:"Dumps entire relationship history on strangers.",category:"emotional"},networker:{health:75,speed:1.5,reward:32,socialDamage:3,color:"#80CBC4",name:"Networking Enthusiast",icon:"🤝",desc:"Wants to grab coffee and ideate some solutions.",category:"professional"},bartender:{health:85,speed:.7,reward:30,socialDamage:2.5,color:"#E6EE9C",name:"Bartender",icon:"🍺",desc:"Professional conversationalist with endless small talk.",category:"patient"},coworker:{health:65,speed:1,reward:25,socialDamage:2,color:"#B39DDB",name:"Bad Code Coworker",icon:"💻",desc:"Submits terrible code and wants you to fix it.",category:"nerdy"},intern:{health:45,speed:2,reward:20,socialDamage:2,color:"#FFCC80",name:"Clueless Intern",icon:"🤷",desc:"Asks endless questions and follows you around.",category:"nerdy"},elevator:{health:40,speed:2.2,reward:18,socialDamage:1.5,color:"#D1C4E9",name:"Elevator Person",icon:"🏢",desc:"Awkward small talk in confined vertical space.",category:"fast"},uberboss:{health:200,speed:.5,reward:80,socialDamage:5,color:"#1565C0",name:"Uber Driver Boss",icon:"🚙",desc:"Ultimate captive audience nightmare with strong opinions.",category:"boss"},karen:{health:250,speed:.6,reward:100,socialDamage:7,color:"#AD1457",name:"Karen Manager Meeting",icon:"👩‍💼",desc:"Meeting that could have been an email but wants face time.",category:"boss"},uncle:{health:220,speed:.4,reward:90,socialDamage:6,color:"#5D4037",name:"Family Reunion Uncle",icon:"👨‍🦳",desc:"Strong political opinions and vacation slideshow ready.",category:"boss"}},w=[{enemies:["neighbor","clerk"],count:3,name:"Monday Morning",desc:"Just some basic social interactions to start the day."},{enemies:["neighbor","clerk","uber"],count:4,name:"Grocery Run",desc:"Running errands exposes you to more people."},{enemies:["performer","elderly"],count:4,name:"Park Walk",desc:"Street performers and chatty elderly folks."},{enemies:["gymguy","performer","clerk"],count:5,name:"Gym Time",desc:"That regular who always talks about reps."},{enemies:["boss","coworker"],count:3,name:"Work Meeting",desc:"Corporate buzzwords incoming!"},{enemies:["evangelist","oversharer","neighbor"],count:5,name:"Community Event",desc:"People really want to share their feelings."},{enemies:["bartender","networker"],count:4,name:"Happy Hour",desc:"Professional social pressure intensifies."},{enemies:["intern","coworker","boss"],count:5,name:"Code Review",desc:"Why did the intern submit 200 lines of console.log?"},{enemies:["elevator","elevator","networker"],count:4,name:"Office Building",desc:"Awkward elevator small talk multiplied."},{enemies:["uberboss"],count:1,name:"Rush Hour Nightmare",desc:"Trapped in a car with a chatty driver."},{enemies:["elderly","oversharer","uncle"],count:4,name:"Family Gathering",desc:"Uncle has strong opinions about everything."},{enemies:["karen"],count:1,name:"Corporate Meeting",desc:"A meeting that could have been an email."}],b={damage:{name:"More Damage",cost:60,desc:"+50% damage",icon:"💥"},rate:{name:"Faster Fire",cost:50,desc:"+40% fire rate",icon:"⚡"},range:{name:"Longer Range",cost:65,desc:"+30% range",icon:"🎯"},wide:{name:"Wider Area",cost:80,desc:"+50% AOE range",icon:"💥"},slow:{name:"Better Slow",cost:55,desc:"Stronger slow effect",icon:"🐌"},heal:{name:"Better Support",cost:70,desc:"2x healing effect",icon:"💚"},nerd_boost:{name:"Nerd Mastery",cost:70,desc:"3x damage vs nerdy enemies",icon:"🤓"},conspiracy:{name:"Deep State",cost:60,desc:"Converts enemies to allies",icon:"👁️"},cute:{name:"Ultra Cute",cost:75,desc:"Stuns enemies briefly",icon:"🥺"},speed:{name:"Caffeine Rush",cost:50,desc:"3x fire rate",icon:"☕"},boring:{name:"Ultra Boring",cost:65,desc:"Puts enemies to sleep",icon:"😴"},nature:{name:"Mother Nature",cost:70,desc:"Summons nature allies",icon:"🌿"},empathy:{name:"Deep Empathy",cost:65,desc:"Converts enemies to friends",icon:"❤️"},bass:{name:"Bass Drop",cost:75,desc:"Stuns all nearby enemies",icon:"🔊"},trivia:{name:"Trivia Master",cost:60,desc:"Boring trivia slows enemies",icon:"🧠"},freeze:{name:"Time Freeze",cost:80,desc:"Completely stops enemies",icon:"❄️"},convert:{name:"True Believer",cost:70,desc:"Converts enemies to fight for you",icon:"🧠"},charm:{name:"Irresistible Charm",cost:65,desc:"Charms enemies to walk backward",icon:"😍"},caffeine:{name:"Infinite Caffeine",cost:55,desc:"Never stops talking",icon:"☕"},trains:{name:"Train Encyclopedia",cost:70,desc:"Double train rampage power and trains!",icon:"🚂"},calming:{name:"Zen Master",cost:60,desc:"Calms enemies into sleep",icon:"🧘"},study:{name:"Study Harder",cost:50,desc:"Faster experience gain",icon:"📚"},experience:{name:"Life Experience",cost:65,desc:"Starts with 5 experience levels",icon:"🎓"},wisdom:{name:"Ancient Wisdom",cost:70,desc:"Max experience gives massive damage boost",icon:"🧠"},harmony:{name:"Perfect Harmony",cost:60,desc:"Stuns last longer and affect more enemies",icon:"🎵"},volume:{name:"Amplified Voice",cost:55,desc:"Singing range and damage increased",icon:"🔊"},repertoire:{name:"Full Repertoire",cost:70,desc:"Multiple song effects and faster cooldown",icon:"🎼"},strength:{name:"Wrestling Training",cost:65,desc:"Can grapple multiple enemies at once",icon:"💪"},grapple:{name:"Master Grappler",cost:60,desc:"Longer grapple duration and stronger hold",icon:"🤼"},listening:{name:"Active Listening",cost:55,desc:"Heals nearby friends while grappling",icon:"👂"}},M=function(){return M=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},M.apply(this,arguments)},S=document.getElementById("gameCanvas"),k=S.getContext("2d"),E={health:20,money:100,wave:1,score:0,selectedFriend:null,enemies:[],friends:[],projectiles:[],speechBubbles:[],trains:[],waveActive:!1,enemiesRemaining:0,codingProgress:0,bananas:[],selectedFriendForUpgrade:null,enemiesSpawned:0,gameOver:!1,gameStarted:!1,mapSelected:!1,currentMap:null,totalEnemiesDefeated:0,gameSpeed:1,darioPhotoUsed:!1,tonyMoveUsed:!1,trainRampageUsed:!1,movingTony:null,unlockedMaps:[0,1,2,3,4,5,6]};function C(){E.health=20,E.money=100,E.wave=1,E.score=0,E.selectedFriend=null,E.enemies=[],E.friends=[],E.projectiles=[],E.speechBubbles=[],E.trains=[],E.waveActive=!1,E.enemiesRemaining=0,E.codingProgress=0,E.bananas=[],E.selectedFriendForUpgrade=null,E.enemiesSpawned=0,E.gameOver=!1,E.gameStarted=!1,E.mapSelected=!1,E.currentMap=null,E.totalEnemiesDefeated=0,E.gameSpeed=1,E.darioPhotoUsed=!1,E.tonyMoveUsed=!1,E.trainRampageUsed=!1,E.movingTony=null,E.unlockedMaps=[0,1,2,3,4,5,6]}function B(e){E=M(M({},E),e)}var A=function(e,t,n){if(n||2===arguments.length)for(var a,i=0,r=t.length;i<r;i++)!a&&i in t||(a||(a=Array.prototype.slice.call(t,0,i)),a[i]=t[i]);return e.concat(a||Array.prototype.slice.call(t))},F=null,I=null;function T(e){var t=document.getElementById("notification");t&&(t.textContent=e,t.style.display="block",setTimeout(function(){t.style.display="none"},3e3))}function D(){var e=document.getElementById("health");e&&(e.textContent=String(Math.max(0,E.health)),E.health<=5?e.classList.add("critical"):e.classList.remove("critical"));var t=document.getElementById("money");t&&(t.textContent=String(E.money));var n=document.getElementById("wave");n&&(n.textContent=String(E.wave));var a=document.getElementById("score");a&&(a.textContent=String(E.score)),Object.keys(x).forEach(function(e){var t=document.getElementById(e+"Btn");t&&(t.disabled=E.money<x[e].cost||E.gameOver||!E.gameStarted||!E.mapSelected)});var i=document.getElementById("nextWaveBtn");i&&(i.disabled=E.gameOver||!E.gameStarted||!E.mapSelected),N();var r=document.getElementById("waveStatus");if(r)if(E.mapSelected)if(E.gameOver)r.textContent="Game Over - Ben's social battery is depleted!",r.style.color="#ff4757";else if(E.waveActive){var o=E.enemies.filter(function(e){return e.alive&&!e.converted}).length,s=Math.min(E.wave-1,w.length-1),l=w[s];r.textContent="".concat(l.name," - ").concat(o," social interactions remaining"),0===o&&E.enemiesSpawned>=E.enemiesRemaining&&!E.gameOver&&(setTimeout(function(){if(B({wave:E.wave+1}),I&&E.gameStarted&&!E.gameOver&&Y(),E.wave>12&&null!==E.currentMap){var e=E.currentMap+1;e<y.length&&!E.unlockedMaps.includes(e)&&(B({unlockedMaps:A(A([],E.unlockedMaps,!0),[e],!1)}),T("New map unlocked: ".concat(y[e].name,"!")))}B({darioPhotoUsed:!1,tonyMoveUsed:!1,movingTony:null,trainRampageUsed:!1}),console.log("Wave abilities reset!");var t=25+3*E.wave;B({money:E.money+t}),R(),r.textContent="".concat(l.name," survived! +").concat(t," Focus Points"),D()},1e3),B({waveActive:!1}))}else{var c=Math.min(E.wave-1,w.length-1),d=w[c];r.textContent="Next: ".concat(d.name),r.style.color="#00ff41"}else r.textContent="Select a map to begin your coding journey!",r.style.color="#FFD700";R()}function R(){var e=0,t="";E.wave<=5?(e=20*(E.wave-1),t="Setting up development environment..."):E.wave<=10?(e=20+16*(E.wave-5),t="Writing core functions..."):(e=100,t="Deployed to production!"),B({codingProgress:e});var n=document.getElementById("progressText");n&&(n.textContent=t);var a=document.getElementById("progressFill");a&&(a.style.width=E.codingProgress+"%")}function L(e){B({selectedFriendForUpgrade:e});var t=document.getElementById("upgradeTitle");t&&(t.textContent="Upgrade ".concat(e.type.toUpperCase()));var n="Current upgrades (".concat(e.upgrades.length,"/2 used): ");0===e.upgrades.length?n+="None":n+=e.upgrades.map(function(e){return b[e].name}).join(", ");var a=document.getElementById("upgradeDescription");a&&(a.textContent=n);var i=document.getElementById("upgradeOptions");if(i){i.innerHTML="";for(var r=function(t){var n=b[t],a=document.createElement("button"),r=e.upgrades.includes(t),o=E.money>=n.cost,s=e.canUpgrade();r?(a.className="upgrade-btn selected",a.innerHTML="".concat(n.icon,"<br>").concat(n.name,"<br>✅ EQUIPPED<br><small>").concat(n.desc,"</small>"),a.disabled=!0):o&&s?(a.className="upgrade-btn",a.innerHTML="".concat(n.icon,"<br>").concat(n.name,"<br>(").concat(n.cost,"🍃)<br><small>").concat(n.desc,"</small>"),a.onclick=function(){return U(t)}):(a.className="upgrade-btn unavailable",a.innerHTML="".concat(n.icon,"<br>").concat(n.name,"<br>(").concat(n.cost,"🍃)<br><small>").concat(n.desc,"</small>"),a.disabled=!0),i.appendChild(a)},o=0,s=x[e.type].upgrades;o<s.length;o++)r(s[o])}var l=document.getElementById("upgradeModal");l&&(l.style.display="flex")}function U(e){var t=E.selectedFriendForUpgrade;if(t){var n=b[e];E.money>=n.cost&&t.upgrade(e)&&(B({money:E.money-n.cost}),N(),D(),P(),T("".concat(t.type.toUpperCase()," upgraded with ").concat(n.name,"!")))}}function P(){var e=document.getElementById("upgradeModal");e&&(e.style.display="none"),B({selectedFriendForUpgrade:null})}function O(){var e=document.getElementById("codexModal");e&&(e.style.display="none")}function N(){for(var e=0,t=E.friends;e<t.length;e++){var n=t[e],a=document.getElementById(n.type+"Btn");if(a){var i=a.querySelector(".upgrade-indicator");i&&(n.canUpgrade()?i.style.display="flex":i.style.display="none")}}}function W(){var e=document.getElementById("mapSelectionModal"),t=document.getElementById("mapGrid");t&&(t.innerHTML="",y.forEach(function(e,n){var a=E.unlockedMaps.includes(n),i=document.createElement("div");i.style.cssText=a?"\n                background: rgba(0, 255, 65, 0.1);\n                border: 2px solid #00ff41;\n                border-radius: 10px;\n                padding: 15px;\n                cursor: pointer;\n                transition: all 0.3s ease;\n                text-align: left;\n            ":"\n                background: rgba(100, 100, 100, 0.1);\n                border: 2px solid #666;\n                border-radius: 10px;\n                padding: 15px;\n                cursor: not-allowed;\n                transition: all 0.3s ease;\n                text-align: left;\n                opacity: 0.5;\n            ";var r=a?"":"🔒 ",o=a?"#00ff41":"#666";i.innerHTML='\n                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">\n                    <h3 style="margin: 0; color: '.concat(o,';">').concat(r).concat(e.name,'</h3>\n                    <span style="font-size: 16px; color: ').concat(o,';">').concat(e.difficulty,'</span>\n                </div>\n                <p style="margin: 5px 0; font-size: 14px; opacity: 0.9;">').concat(e.desc,'</p>\n                <p style="margin: 5px 0; font-size: 12px; opacity: 0.7; font-style: italic;">').concat(e.theme,'</p>\n                <p style="margin: 5px 0; font-size: 11px; opacity: 0.6;">\n                    ').concat(e.spawns.length," entrance").concat(e.spawns.length>1?"s":""," • ").concat(e.paths.length," path").concat(e.paths.length>1?"s":"","\n                </p>\n                ").concat(a?"":'<p style="margin: 5px 0; font-size: 11px; color: #ff6b6b;">Complete previous maps to unlock</p>',"\n            "),a&&(i.addEventListener("mouseenter",function(){i.style.background="rgba(0, 255, 65, 0.2)",i.style.transform="translateY(-2px)",i.style.boxShadow="0 5px 15px rgba(0, 255, 65, 0.3)"}),i.addEventListener("mouseleave",function(){i.style.background="rgba(0, 255, 65, 0.1)",i.style.transform="translateY(0)",i.style.boxShadow="none"}),i.addEventListener("click",function(){return j(n)})),t.appendChild(i)})),e&&(e.style.display="flex")}function j(e){C(),B({currentMap:e,mapSelected:!0,gameStarted:!0});var t=document.getElementById("mapSelectionModal");t&&(t.style.display="none");var n=document.getElementById("progressText");n&&(n.textContent=y[e].theme),D(),console.log("Selected map: ".concat(y[e].name))}function z(){B({selectedFriend:null}),S.style.cursor="default",document.querySelectorAll(".friend-btn").forEach(function(e){return e.classList.remove("selected")});var e=document.getElementById("cancelText");e&&(e.style.display="none")}function q(e){try{var t=localStorage.getItem("benDefense_".concat(e));return t?JSON.parse(t):null}catch(e){return console.error("Failed to parse save data:",e),null}}function H(e){I=e;var t=document.getElementById("startGameModal");t&&(t.style.display="none"),C(),W()}function G(e,t){if(I=e,function(e){void 0===e&&(e="quicksave");try{var t=localStorage.getItem("benDefense_".concat(e));if(!t)return T("No save found: ".concat(e)),!1;var n=JSON.parse(t);return B({health:n.health,money:n.money,wave:n.wave,score:n.score,currentMap:n.currentMap,totalEnemiesDefeated:n.totalEnemiesDefeated||0,codingProgress:n.codingProgress||0,unlockedMaps:n.unlockedMaps||[0],gameStarted:n.gameStarted,mapSelected:n.mapSelected,waveActive:n.waveActive||!1,darioPhotoUsed:n.darioPhotoUsed||!1,tonyMoveUsed:n.tonyMoveUsed||!1,trainRampageUsed:n.trainRampageUsed||!1,friends:[],enemies:[],projectiles:[],trains:[],speechBubbles:[],bananas:[]}),n.friends&&B({friends:n.friends.map(function(e){var t=new ee(e.x,e.y,e.type);return e.upgrades&&e.upgrades.forEach(function(e){t.upgrade(e)}),e.experienceLevel&&(t.experienceLevel=e.experienceLevel),t})}),D(),T("Game loaded from ".concat(e,"!")),console.log("Game loaded successfully:",e),!0}catch(e){return T("Failed to load game!"),console.error("Load failed:",e),!1}}(e)){var n=document.getElementById("startGameModal");n&&(n.style.display="none"),W()}else T("Failed to load save game!")}function _(){console.log("Showing storyline modal only"),document.querySelectorAll(".modal, .storyline-modal").forEach(function(e){e.style.display="none"});var e=document.getElementById("storylineModal");e&&(e.style.display="flex",console.log("Storyline modal is now visible"));var t=document.querySelector(".game-container");t&&(t.style.opacity="0.3",t.style.pointerEvents="none"),B({gameStarted:!1,mapSelected:!1,gameOver:!1})}function Y(){if(I){var e={health:E.health,money:E.money,wave:E.wave,score:E.score,currentMap:E.currentMap,totalEnemiesDefeated:E.totalEnemiesDefeated,codingProgress:E.codingProgress,unlockedMaps:E.unlockedMaps,friends:E.friends.map(function(e){return{x:e.x,y:e.y,type:e.type,upgrades:e.upgrades,experienceLevel:e.experienceLevel||0}}),darioPhotoUsed:E.darioPhotoUsed,tonyMoveUsed:E.tonyMoveUsed,trainRampageUsed:E.trainRampageUsed,gameStarted:E.gameStarted,mapSelected:E.mapSelected,waveActive:E.waveActive,savedAt:(new Date).toISOString(),version:"1.0"};localStorage.setItem("benDefense_".concat(I),JSON.stringify(e)),console.log("Auto-saved to slot:",I)}else console.log("No currentSaveSlot set - cannot auto-save")}function J(){var e,t=document.getElementById("startGameModal"),n=document.getElementById("saveSlotGrid");if(t&&n){n.innerHTML="";for(var a=function(t){var a="slot".concat(t),i=q(a),r=document.createElement("div");if(r.style.cssText="\n                background: rgba(0, 255, 65, 0.1);\n                border: 2px solid #00ff41;\n                border-radius: 15px;\n                padding: 25px;\n                cursor: pointer;\n                transition: all 0.3s ease;\n                position: relative;\n                min-height: 120px;\n                display: flex;\n                flex-direction: column;\n                justify-content: center;\n            ",i){var o=new Date(i.savedAt).toLocaleString(),s=(null===(e=y[i.currentMap])||void 0===e?void 0:e.name)||"Unknown Map";r.innerHTML='\n                    <div style="text-align: left;">\n                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px; color: #00ff41;">\n                            Save Slot '.concat(t,'\n                        </div>\n                        <div style="font-size: 14px; margin-bottom: 4px;">\n                            <strong>Wave ').concat(i.wave,"</strong> • ").concat(i.score,' commits\n                        </div>\n                        <div style="font-size: 12px; opacity: 0.8; margin-bottom: 4px;">\n                            📍 ').concat(s," • ❤️ ").concat(i.health," • 💰 ").concat(i.money,'\n                        </div>\n                        <div style="font-size: 11px; opacity: 0.6;">\n                            ').concat(o,"\n                        </div>\n                    </div>\n                    <button onclick=\"window.deleteSaveSlot('").concat(a,'\', event)"\n                            style="position: absolute; top: 10px; right: 10px; background: #ff4757; border: none;\n                                   border-radius: 5px; color: white; padding: 5px 8px; cursor: pointer; font-size: 12px;">\n                        🗑️\n                    </button>\n                '),r.addEventListener("click",function(){return G(a)})}else r.innerHTML='\n                    <div style="text-align: center; opacity: 0.8;">\n                        <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px; color: #00ff41;">\n                            Save Slot '.concat(t,'\n                        </div>\n                        <div style="font-size: 48px; margin-bottom: 10px;">➕</div>\n                        <div style="font-size: 14px;">\n                            Start New Game\n                        </div>\n                    </div>\n                '),r.addEventListener("click",function(){return H(a)});r.addEventListener("mouseenter",function(){r.style.background="rgba(0, 255, 65, 0.2)",r.style.transform="translateY(-3px)",r.style.boxShadow="0 8px 25px rgba(0, 255, 65, 0.3)"}),r.addEventListener("mouseleave",function(){r.style.background="rgba(0, 255, 65, 0.1)",r.style.transform="translateY(0)",r.style.boxShadow="none"}),n.appendChild(r)},i=1;i<=3;i++)a(i);t.style.display="flex"}}function X(e,t,n){E.speechBubbles.push(new ne(e,t,n))}function V(){for(var e=0,t=E.enemies;e<t.length;e++){var n=t[e];n.alive&&!n.converted&&n.stun(180)}X(400,200,"Family photo time! Everyone smile! 📷"),T("Dario's family photo paused all enemies!")}function K(e){if(null!==E.currentMap){for(var t=y[E.currentMap],n=[-30,30],a=t.paths[Math.floor(Math.random()*t.paths.length)],i={dist:1/0,idx:0},r=0;r<a.length-1;r++){var o=a[r],s=a[r+1],l=(o.x+s.x)/2,c=(o.y+s.y)/2,d=Math.hypot(e.x-l,e.y-c);d<i.dist&&(i={dist:d,idx:r})}for(var p=e.upgrades.includes("trains"),h=p?2:1,g=p?120:80,m=0;m<h;m++){var u=new ae(e.x,e.y+(n[m]||0));u.path=a,u.goingBackwards=!0,u.nextWaypoint=Math.max(0,i.idx-1),u.damage=g,E.trains.push(u)}var f=p?"🚂🚂 DOUBLE TRAIN RAMPAGE! 🚂🚂":"🚂 TRAIN RAMPAGE! All aboard! 🚂";X(e.x,e.y-30,f),T(p?"Double train power!":"Ruel's train is coming through!")}}function Q(e,t,n,a,i,r){var o=i-n,s=r-a,l=Math.sqrt(o*o+s*s),c=Math.max(0,Math.min(1,((e-n)*o+(t-a)*s)/(l*l))),d=n+c*o,p=a+c*s;return Math.sqrt(Math.pow(e-d,2)+Math.pow(t-p,2))}var Z=function(){function e(e,t){this.x=e,this.y=t,this.vx=8*(Math.random()-.5),this.vy=8*(Math.random()-.5)-2,this.gravity=.3,this.life=60,this.maxLife=60}return e.prototype.update=function(){this.x+=this.vx*E.gameSpeed,this.y+=this.vy*E.gameSpeed,this.vy+=this.gravity*E.gameSpeed,this.life-=E.gameSpeed},e.prototype.draw=function(){var e=this.life/this.maxLife;k.globalAlpha=e,k.fillStyle="#FFEB3B",k.fillRect(this.x-2,this.y-2,4,4),k.globalAlpha=1},e}(),$=function(){function e(e){this.justDied=!1;var t=v[e];this.type=e;var n=Math.pow(1.15,E.wave-1);if(this.maxHealth=Math.floor(t.health*n),this.health=this.maxHealth,this.baseSpeed=t.speed*(1+.03*(E.wave-1)),this.speed=this.baseSpeed,this.reward=Math.floor(t.reward*(1+.05*(E.wave-1))),this.socialDamage=t.socialDamage,this.color=t.color,this.name=t.name,this.icon=t.icon,null===E.currentMap)throw new Error("Current map is not set");var a=y[E.currentMap],i=a.spawns[Math.floor(Math.random()*a.spawns.length)];this.currentPath=a.paths[i.pathIndex],this.x=i.x-30,this.y=i.y,this.pathIndex=0,this.alive=!0,this.slowEffect=0,this.stunned=0,this.converted=!1,this.reachedEnd=!1,this.grappled=!1,this.grappleStun=0}return e.prototype.update=function(){if(this.alive&&!E.gameOver)if(this.stunned>0)this.stunned-=E.gameSpeed;else{if(this.grappled&&this.grappleStun>0)return this.grappleStun-=E.gameSpeed,void(this.grappleStun<=0&&(this.grappled=!1));this.speed=this.baseSpeed,this.slowEffect>0&&(this.speed*=.3,this.slowEffect-=E.gameSpeed);var e=this.speed*E.gameSpeed,t=this.converted?Math.max(0,this.pathIndex-1):this.pathIndex+1,n=this.currentPath[t];if(!n)return this.converted||this.reachedEnd||(this.reachedEnd=!0,X(this.x,this.y-30,"".concat(this.name," drained ").concat(this.socialDamage," social energy!")),E.health=Math.max(0,E.health-this.socialDamage),E.health<=0&&(E.gameOver=!0,function(){B({gameOver:!0}),console.log("Game Over triggered");var e=document.getElementById("finalWave");e&&(e.textContent=String(E.wave));var t=document.getElementById("finalScore");t&&(t.textContent=String(E.score));var n=document.getElementById("totalEnemies");n&&(n.textContent=String(E.totalEnemiesDefeated));var a=document.getElementById("gameOverModal");a&&(a.style.display="flex")}()),D()),void(this.alive=!1);var a=n.x-this.x,i=n.y-this.y,r=Math.sqrt(a*a+i*i);r<5?this.converted?this.pathIndex=Math.max(0,this.pathIndex-1):this.pathIndex++:(this.x+=a/r*e,this.y+=i/r*e)}},e.prototype.draw=function(){if(this.alive){k.fillStyle=this.converted?"#00ff41":this.color,"karen"===this.type||"uberboss"===this.type||"uncle"===this.type?k.fillRect(this.x-12,this.y-12,24,24):k.fillRect(this.x-8,this.y-8,16,16),k.fillStyle="white",k.font="12px Arial",k.textAlign="center",k.fillText(this.icon,this.x,this.y+4);var e=this.health/this.maxHealth;k.fillStyle="red",k.fillRect(this.x-12,this.y-18,24,4),k.fillStyle="green",k.fillRect(this.x-12,this.y-18,24*e,4),this.slowEffect>0&&(k.strokeStyle="blue",k.lineWidth=2,k.strokeRect(this.x-10,this.y-10,20,20)),this.stunned>0&&(k.fillStyle="yellow",k.fillText("😵",this.x,this.y-20)),this.grappled&&(k.strokeStyle="#795548",k.lineWidth=3,k.strokeRect(this.x-12,this.y-12,24,24),k.fillStyle="#795548",k.fillText("🤼",this.x,this.y-25)),this.converted&&(k.fillStyle="#00ff41",k.fillText("💚",this.x,this.y-20))}},e.prototype.takeDamage=function(e,t){if(this.alive&&!this.converted){var n=e,a=x[t];if(a&&(a.strong.includes(this.type)?n*=2:a.weak.includes(this.type)&&(n*=.5)),this.health-=n,this.health<=0){this.alive=!1,this.justDied=!0,E.money+=this.reward,E.score+=this.reward,E.totalEnemiesDefeated++;for(var i=0;i<8;i++)E.bananas.push(new Z(this.x,this.y));D()}}},e.prototype.applySlow=function(e){this.slowEffect=Math.max(this.slowEffect,e)},e.prototype.stun=function(e){this.stunned=Math.max(this.stunned,e)},e.prototype.convert=function(){this.converted=!0,this.color="#00ff41"},e}(),ee=function(){function e(e,t,n){this.x=e,this.y=t,this.type=n,this.stats=JSON.parse(JSON.stringify(x[n])),this.lastShot=0,this.target=null,this.specialCooldown=0,this.upgrades=[],"maddie"===n&&(this.experienceLevel=0,this.maxExperience=10,this.experienceGainRate=1),"oise"===n&&(this.grappledEnemies=[])}return e.prototype.update=function(){if(!E.gameOver){"maddie"===this.type&&this.updateMaddieExperience(),"oise"===this.type&&this.updateOiseGrappling(),this.target=null;for(var e=this.stats.range,t=0,n=E.enemies;t<n.length;t++){var a=n[t];if(a.alive&&!a.converted){var i=Math.sqrt(Math.pow(a.x-this.x,2)+Math.pow(a.y-this.y,2));i<e&&(this.target=a,e=i)}}var r=this.stats.fireRate/E.gameSpeed;this.target&&Date.now()-this.lastShot>r&&(this.attack(),this.lastShot=Date.now()),this.specialCooldown>0&&(this.specialCooldown-=E.gameSpeed),this.useSpecialAbility()}},e.prototype.updateMaddieExperience=function(){if("maddie"===this.type&&void 0!==this.experienceLevel&&void 0!==this.maxExperience){for(var e=0,t=0,n=E.enemies;t<n.length;t++){var a=n[t];a.justDied&&Math.sqrt(Math.pow(a.x-this.x,2)+Math.pow(a.y-this.y,2))<150&&(e+=this.experienceGainRate||1)}if(e>0&&this.experienceLevel<this.maxExperience){this.experienceLevel=Math.min(this.maxExperience,this.experienceLevel+e);var i=x.maddie.damage,r=1+.15*this.experienceLevel;this.stats.damage=Math.floor(i*r),this.experienceLevel===this.maxExperience&&X(this.x,this.y-30,"Maddie graduated! 🎓")}}},e.prototype.updateOiseGrappling=function(){"oise"===this.type&&this.grappledEnemies&&(this.grappledEnemies=this.grappledEnemies.filter(function(e){return!(!e.enemy.alive||(e.duration-=E.gameSpeed,e.duration<=0&&(e.enemy.grappled=!1,1)))}))},e.prototype.attack=function(){this.target&&("slow_only"!==this.stats.special&&"conspiracy_only"!==this.stats.special||this.upgrades.includes("damage"))&&(this.stats.special.includes("wide")&&this.upgrades.includes("wide")?this.wideshotAttack():E.projectiles.push(new te(this.x,this.y,this.target,this.stats.damage,this.type)))},e.prototype.wideshotAttack=function(){for(var e=this.stats.range+(this.upgrades.includes("wide")?50:0),t=0,n=E.enemies;t<n.length;t++){var a=n[t];a.alive&&!a.converted&&Math.sqrt(Math.pow(a.x-this.x,2)+Math.pow(a.y-this.y,2))<=e&&E.projectiles.push(new te(this.x,this.y,a,this.stats.damage,this.type))}},e.prototype.useSpecialAbility=function(){if(!(this.specialCooldown>0))switch(this.stats.special){case"listener":for(var e=this.upgrades.includes("heal")?400:200,t=0,n=E.friends;t<n.length;t++){var a=n[t];Math.sqrt(Math.pow(a.x-this.x,2)+Math.pow(a.y-this.y,2))<100&&a!==this&&(a.lastShot=Math.max(0,a.lastShot-e))}this.specialCooldown=300;break;case"slow_only":for(var i=this.upgrades.includes("slow")?150:90,r=0,o=E.enemies;r<o.length;r++)(C=o[r]).alive&&!C.converted&&Math.sqrt(Math.pow(C.x-this.x,2)+Math.pow(C.y-this.y,2))<this.stats.range&&C.applySlow(i);this.specialCooldown=120;break;case"conspiracy_only":if(this.upgrades.includes("convert")){for(var s=0,l=E.enemies;s<l.length;s++)(C=l[s]).alive&&!C.converted&&Math.sqrt(Math.pow(C.x-this.x,2)+Math.pow(C.y-this.y,2))<this.stats.range&&Math.random()<.3&&(C.convert(),X(C.x,C.y-30,"Pō converted them!"));this.specialCooldown=600}else{for(var c=this.upgrades.includes("conspiracy")?120:80,d=0,p=E.enemies;d<p.length;d++)(C=p[d]).alive&&!C.converted&&Math.sqrt(Math.pow(C.x-this.x,2)+Math.pow(C.y-this.y,2))<this.stats.range&&C.applySlow(c);this.specialCooldown=180}break;case"cuteness_wide":if(this.upgrades.includes("cute")){for(var h=0,g=E.enemies;h<g.length;h++)(C=g[h]).alive&&!C.converted&&Math.sqrt(Math.pow(C.x-this.x,2)+Math.pow(C.y-this.y,2))<this.stats.range&&C.stun(30);this.specialCooldown=600}break;case"singing_stun":for(var m=this.upgrades.includes("harmony")?this.stats.range+50:this.stats.range,u=this.upgrades.includes("harmony")?120:80,f=0,y=0,x=E.enemies;y<x.length;y++)(C=x[y]).alive&&!C.converted&&Math.sqrt(Math.pow(C.x-this.x,2)+Math.pow(C.y-this.y,2))<m&&(C.stun(u),f++);f>0&&X(this.x,this.y-30,"♪ Aviva's song stunned ".concat(f," enemies! ♪"));var v=this.upgrades.includes("repertoire")?400:600;this.specialCooldown=v;break;case"grapple_close":if(!this.grappledEnemies)return;for(var w=this.upgrades.includes("strength")?3:1,b=this.upgrades.includes("grapple")?300:180,M=0,S=0,k=E.enemies;S<k.length;S++){var C;if((C=k[S]).alive&&!C.converted&&!C.grappled){if(M>=w)break;Math.sqrt(Math.pow(C.x-this.x,2)+Math.pow(C.y-this.y,2))<60&&(C.grappled=!0,C.grappleStun=b,this.grappledEnemies.push({enemy:C,duration:b}),M++,X(C.x,C.y-30,"Grappled! 🤼"))}}if(this.upgrades.includes("listening")&&this.grappledEnemies.length>0)for(var B=0,A=E.friends;B<A.length;B++)a=A[B],Math.sqrt(Math.pow(a.x-this.x,2)+Math.pow(a.y-this.y,2))<120&&a!==this&&(a.lastShot=Math.max(0,a.lastShot-100));this.specialCooldown=240}},e.prototype.canUpgrade=function(){return this.upgrades.length<2},e.prototype.upgrade=function(e){if(!this.canUpgrade()||this.upgrades.includes(e))return!1;switch(this.upgrades.push(e),e){case"damage":this.stats.damage=Math.floor(1.5*this.stats.damage);break;case"rate":this.stats.fireRate=Math.floor(.6*this.stats.fireRate);break;case"range":this.stats.range=Math.floor(1.3*this.stats.range);break;case"speed":this.stats.fireRate=Math.floor(.33*this.stats.fireRate);break;case"study":"maddie"===this.type&&(this.experienceGainRate=2);break;case"experience":"maddie"===this.type&&void 0!==this.experienceLevel&&void 0!==this.maxExperience&&(this.experienceLevel=Math.min(this.maxExperience,this.experienceLevel+5));break;case"wisdom":"maddie"===this.type&&void 0!==this.maxExperience&&(this.maxExperience=15);break;case"volume":"aviva"===this.type&&(this.stats.range=Math.floor(1.4*this.stats.range),this.stats.damage=Math.floor(1.3*this.stats.damage))}return!0},e.prototype.draw=function(){if(k.fillStyle=this.stats.color,k.fillRect(this.x-15,this.y-15,30,30),k.strokeStyle="#00ff41",k.lineWidth=2,k.strokeRect(this.x-15,this.y-15,30,30),"dario"!==this.type||E.darioPhotoUsed||(k.fillStyle="yellow",k.fillRect(this.x-20,this.y-20,10,10),k.fillStyle="black",k.font="8px Arial",k.textAlign="center",k.fillText("📷",this.x-15,this.y-13)),"tony"!==this.type||E.tonyMoveUsed||(k.fillStyle="cyan",k.fillRect(this.x+10,this.y-20,10,10),k.fillStyle="black",k.font="8px Arial",k.textAlign="center",k.fillText("➤",this.x+15,this.y-13)),"ruel"!==this.type||E.trainRampageUsed||(k.fillStyle="#4CAF50",k.fillRect(this.x-20,this.y+10,10,10),k.fillStyle="white",k.font="8px Arial",k.textAlign="center",k.fillText("🚂",this.x-15,this.y+17)),"maddie"===this.type&&void 0!==this.experienceLevel&&void 0!==this.maxExperience){k.fillStyle="#3F51B5",k.fillRect(this.x-20,this.y+15,40,6),k.fillStyle="#00ff41";var e=this.experienceLevel/this.maxExperience*40;k.fillRect(this.x-20,this.y+15,e,6),k.fillStyle="white",k.font="8px Arial",k.textAlign="center",k.fillText("LV".concat(this.experienceLevel),this.x,this.y+26)}if("aviva"===this.type&&this.specialCooldown>0&&(k.fillStyle="#FF6B9D",k.fillText("♪",this.x-20,this.y-20)),"oise"===this.type&&this.grappledEnemies&&this.grappledEnemies.length>0&&(k.fillStyle="#795548",k.fillText("🤼".concat(this.grappledEnemies.length),this.x+15,this.y-20)),this.upgrades.length>0){k.fillStyle="gold";for(var t=0;t<this.upgrades.length;t++)k.fillRect(this.x-18+8*t,this.y-18,6,6)}k.fillStyle="white",k.font="bold 8px Arial",k.textAlign="center",k.fillText(this.type.toUpperCase(),this.x,this.y+2),E.selectedFriend===this.type&&(k.strokeStyle="rgba(255, 255, 255, 0.3)",k.beginPath(),k.arc(this.x,this.y,this.stats.range,0,2*Math.PI),k.stroke())},e}(),te=function(){function e(e,t,n,a,i){this.x=e,this.y=t,this.target=n,this.damage=a,this.attackerType=i,this.speed=7,this.alive=!0}return e.prototype.update=function(){if(this.alive&&this.target.alive&&!this.target.converted&&!E.gameOver){var e=this.target.x-this.x,t=this.target.y-this.y,n=Math.sqrt(e*e+t*t);if(n<10)this.target.takeDamage(this.damage,this.attackerType),this.alive=!1;else{var a=this.speed*E.gameSpeed;this.x+=e/n*a,this.y+=t/n*a}}else this.alive=!1},e.prototype.draw=function(){if(this.alive){var e=x[this.attackerType];k.fillStyle=e?e.color:"#00FF00",k.fillRect(this.x-3,this.y-3,6,6)}},e}(),ne=function(){function e(e,t,n){this.x=e,this.y=t,this.message=n,this.life=180,this.maxLife=180}return e.prototype.update=function(){this.life-=E.gameSpeed},e.prototype.draw=function(){if(!(this.life<=0)){var e=Math.min(1,this.life/60);k.globalAlpha=e,k.font="".concat(12,"px Courier New"),k.textBaseline="top";for(var t=10,n=[],a="",i=0,r=this.message.split(" ");i<r.length;i++){var o=r[i],s=a?a+" "+o:o;k.measureText(s).width+16>200?(a&&n.push(a),a=o):a=s}a&&n.push(a);for(var l=0,c=0,d=n;c<d.length;c++){var p=d[c],h=k.measureText(p).width;h>l&&(l=h)}l+=16;var g=12*1.2,m=n.length*g+16,u=l/2,f=this.x;f-u<0?f=u:f+u>k.canvas.width&&(f=k.canvas.width-u);var y=this.y-t-m;y<0?y=0:y+m+t>k.canvas.height&&(y=k.canvas.height-m-t),k.fillStyle="rgba(0,0,0,0.9)",k.strokeStyle="#00ff41",k.lineWidth=2,k.fillRect(f-u,y,l,m),k.strokeRect(f-u,y,l,m);var x=this.x,v=y+m;k.beginPath(),k.moveTo(x-t,v),k.lineTo(x,v+t),k.lineTo(x+t,v),k.closePath(),k.fill(),k.stroke(),k.fillStyle="#00ff41",k.textAlign="center";for(var w=0;w<n.length;w++){var b=f,M=y+8+w*g;k.fillText(n[w],b,M)}k.globalAlpha=1}},e}(),ae=function(){function e(e,t){this.x=e,this.y=t,this.speed=4,this.damage=80,this.width=60,this.height=40,this.life=200,this.maxLife=300,this.hitEnemies=new Set,this.path=null,this.nextWaypoint=0,this.pathComplete=!1,this.goingBackwards=!1}return e.prototype.update=function(){if(this.life-=E.gameSpeed,this.path&&!this.pathComplete){var e=this.path[this.nextWaypoint];if(e){var t=e.x-this.x,n=e.y-this.y;if((o=Math.sqrt(t*t+n*n))<8)this.goingBackwards?(this.nextWaypoint--,this.nextWaypoint<0&&(this.pathComplete=!0)):(this.nextWaypoint++,this.nextWaypoint>=this.path.length&&(this.pathComplete=!0));else{var a=this.speed*E.gameSpeed;this.x+=t/o*a,this.y+=n/o*a}}}for(var i=0,r=E.enemies;i<r.length;i++){var o,s=r[i];if(s.alive&&!s.converted&&!this.hitEnemies.has(s)&&(o=Math.sqrt(Math.pow(s.x-this.x,2)+Math.pow(s.y-this.y,2)))<30){this.hitEnemies.add(s),s.takeDamage(this.damage,"train"),X(s.x,s.y-30,"CHOO CHOO! 🚂");for(var l=0;l<12;l++)E.bananas.push(new Z(s.x,s.y))}}},e.prototype.draw=function(){if(!(this.life<=0)){var e=Math.min(1,this.life/60);k.globalAlpha=e,k.fillStyle="#4CAF50",k.fillRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height),k.strokeStyle="#2E7D32",k.lineWidth=3,k.strokeRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height),k.fillStyle="white",k.font="bold 20px Arial",k.textAlign="center",k.fillText("🚂",this.x,this.y+7);var t=15,n=0;if(this.path&&this.nextWaypoint>=0&&this.nextWaypoint<this.path.length){var a=this.path[this.nextWaypoint],i=a.x-this.x,r=a.y-this.y,o=Math.sqrt(i*i+r*r);o>0&&(t=-i/o*20,n=-r/o*20)}k.fillStyle="rgba(255, 255, 255, 0.7)",k.font="16px Arial";for(var s=0;s<3;s++){var l=this.x+t*(s+1)+(10*Math.random()-5),c=this.y+n*(s+1)+(10*Math.random()-5);k.fillText("💨",l,c)}k.globalAlpha=1}},e.prototype.isAlive=function(){return this.life>0&&!this.pathComplete},e}();function ie(){k.textBaseline="alphabetic",k.textAlign="start",k.font="12px Courier New",k.fillStyle="#00ff41",k.clearRect(0,0,S.width,S.height),k.strokeStyle="rgba(0, 255, 65, 0.1)",k.lineWidth=1;for(var e=0;e<S.width;e+=50)k.beginPath(),k.moveTo(e,0),k.lineTo(e,S.height),k.stroke();for(var t=0;t<S.height;t+=50)k.beginPath(),k.moveTo(0,t),k.lineTo(S.width,t),k.stroke();if(function(){if(E.mapSelected&&null!==E.currentMap){for(var e=y[E.currentMap],t=0;t<e.paths.length;t++){var n=e.paths[t];k.strokeStyle="#333",k.lineWidth=30,k.beginPath(),k.moveTo(n[0].x,n[0].y);for(var a=1;a<n.length;a++)k.lineTo(n[a].x,n[a].y);k.stroke(),k.strokeStyle="#555",k.lineWidth=2,k.stroke()}for(var i=0,r=e.spawns;i<r.length;i++){var o=r[i];k.fillStyle="#FF4500",k.font="bold 12px Arial",k.textAlign="center",k.fillText("SPAWN",o.x+60,o.y+5)}k.fillStyle=E.health<=5?"#ff4757":"#00ff41",k.fillRect(725,225,50,50),k.fillStyle="black",k.font="14px Arial",k.textAlign="center",k.fillText("BEN",750,245),k.fillText("🧑‍💻",750,265)}}(),E.gameStarted&&(E.friends.forEach(function(e){e.update(),e.draw()}),B({enemies:E.enemies.filter(function(e){return e.update(),e.draw(),e.alive})}),B({projectiles:E.projectiles.filter(function(e){return e.update(),e.draw(),e.alive})}),B({bananas:E.bananas.filter(function(e){return e.update(),e.draw(),e.life>0})}),B({trains:E.trains.filter(function(e){return e.update(),e.draw(),e.isAlive()})}),B({speechBubbles:E.speechBubbles.filter(function(e){return e.update(),e.draw(),e.life>0})})),E.selectedFriend&&!E.gameOver&&void 0!==E.mouseX&&void 0!==E.mouseY){var n=E.mouseX,a=E.mouseY,i=!re(n,a)&&!oe(n,a);k.fillStyle=i?"rgba(0, 255, 65, 0.8)":"rgba(255, 0, 0, 0.8)",k.fillRect(n-15,a-15,30,30),k.strokeStyle=i?"#00ff41":"#ff4757",k.lineWidth=3,k.strokeRect(n-15,a-15,30,30),k.fillStyle="white",k.font="bold 10px Arial",k.textAlign="center",k.fillText(E.selectedFriend.toUpperCase(),n,a+3),k.strokeStyle=i?"rgba(0, 255, 65, 0.6)":"rgba(255, 0, 0, 0.6)",k.lineWidth=2,k.setLineDash([5,5]),k.beginPath(),k.arc(n,a,x[E.selectedFriend].range,0,2*Math.PI),k.stroke(),k.setLineDash([])}D(),requestAnimationFrame(ie)}function re(e,t){if(!E.mapSelected||null===E.currentMap)return!1;for(var n=0,a=y[E.currentMap].paths;n<a.length;n++)for(var i=a[n],r=0;r<i.length-1;r++){var o=i[r],s=i[r+1];if(se(e,t,o.x,o.y,s.x,s.y)<40)return!0}return!1}function oe(e,t){return E.friends.some(function(n){return Math.sqrt(Math.pow(n.x-e,2)+Math.pow(n.y-t,2))<35})}function se(e,t,n,a,i,r){var o=i-n,s=r-a,l=o*o+s*s;if(0===l)return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-a,2));var c=((e-n)*o+(t-a)*s)/l,d=n+(c=Math.max(0,Math.min(1,c)))*o,p=a+c*s;return Math.sqrt(Math.pow(e-d,2)+Math.pow(t-p,2))}S.addEventListener("click",function(e){var t=S.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top;if(console.log("Canvas clicked at ".concat(n,", ").concat(a)),!E.gameOver&&E.gameStarted){for(var i=!1,r=0,o=E.friends;r<o.length;r++)if("dario"===(p=o[r]).type&&!E.darioPhotoUsed&&Math.sqrt(Math.pow(p.x-n,2)+Math.pow(p.y-a,2))<25){B({darioPhotoUsed:!0}),V(),i=!0;break}if(!i)for(var s=0,l=E.friends;s<l.length;s++)if("ruel"===(p=l[s]).type&&!E.trainRampageUsed&&Math.sqrt(Math.pow(p.x-n,2)+Math.pow(p.y-a,2))<25){B({trainRampageUsed:!0}),K(p),i=!0;break}if(!i)for(var c=0,d=E.friends;c<d.length;c++){var p;if("tony"===(p=d[c]).type&&!E.tonyMoveUsed&&Math.sqrt(Math.pow(p.x-n,2)+Math.pow(p.y-a,2))<25){B({movingTony:p}),X(p.x,p.y-30,"Hey I'm coming to visit!"),T("Click where Tony should move to!"),i=!0;break}}!i&&E.movingTony&&(re(n,a)||oe(n,a)?T("Can't move Tony there!"):(E.movingTony.x=n,E.movingTony.y=a,B({tonyMoveUsed:!0}),X(n,a-30,"Tony relocated!"),B({movingTony:null}),i=!0)),i||E.movingTony||function(e,t){if(E.selectedFriend&&!E.gameOver){var n=x[E.selectedFriend];E.money<n.cost||(function(e,t){if(!E.mapSelected||null===E.currentMap)return!1;for(var n=0,a=y[E.currentMap].paths;n<a.length;n++)for(var i=a[n],r=0;r<i.length-1;r++){var o=i[r],s=i[r+1];if(Q(e,t,o.x,o.y,s.x,s.y)<40)return!0}return!1}(e,t)||function(e,t){return E.friends.some(function(n){return Math.sqrt(Math.pow(n.x-e,2)+Math.pow(n.y-t,2))<35})}(e,t)?T("Cannot place here!"):(console.log("Placing ".concat(E.selectedFriend," at ").concat(e,", ").concat(t)),B({friends:A(A([],E.friends,!0),[new ee(e,t,E.selectedFriend)],!1),money:E.money-n.cost}),z(),D(),console.log("Total friends: ".concat(E.friends.length))))}}(n,a)}}),S.addEventListener("contextmenu",function(e){if(e.preventDefault(),!E.gameOver){if(E.selectedFriend)return void z();for(var t=S.getBoundingClientRect(),n=e.clientX-t.left,a=e.clientY-t.top,i=0,r=E.friends;i<r.length;i++){var o=r[i];if(Math.sqrt(Math.pow(o.x-n,2)+Math.pow(o.y-a,2))<25){L(o);break}}}}),S.addEventListener("mousemove",function(e){var t=S.getBoundingClientRect();B({mouseX:e.clientX-t.left,mouseY:e.clientY-t.top})}),document.addEventListener("keydown",function(e){if("Escape"===e.key){E.selectedFriend&&z();var t=document.getElementById("upgradeModal");t&&"flex"===t.style.display&&P();var n=document.getElementById("codexModal");n&&"flex"===n.style.display&&O()}}),window.selectFriend=function(e){if(E.money>=x[e].cost&&!E.gameOver&&E.gameStarted){document.querySelectorAll(".friend-btn").forEach(function(e){return e.classList.remove("selected")}),B({selectedFriend:e}),S.style.cursor="crosshair";var t=document.getElementById(e+"Btn");t&&t.classList.add("selected");var n=document.getElementById("cancelText");n&&(n.style.display="block"),console.log("Selected friend: ".concat(e))}},window.startNextWave=function(){!E.waveActive&&!E.gameOver&&E.gameStarted&&E.mapSelected&&function(){if(!E.gameOver){var e=Math.min(E.wave-1,w.length-1),t=w[e],n=document.getElementById("waveTitle");n&&(n.textContent="Wave ".concat(E.wave,": ").concat(t.name));var a=document.getElementById("waveDescription");a&&(a.textContent=t.desc);var i=document.getElementById("enemyPreview");if(i){i.innerHTML="";for(var r={},o=0,s=t.enemies;o<s.length;o++)r[p=s[o]]=(r[p]||0)+1;for(var l=0,c=Object.entries(r);l<c.length;l++){var d=c[l],p=d[0],h=d[1],g=v[p],m=document.createElement("div");m.className="enemy-icon",m.style.backgroundColor=g.color,m.textContent=g.icon,m.title="".concat(g.name," x").concat(h),i.appendChild(m)}}var u=document.getElementById("waveModal");u&&(u.style.display="flex")}}()},window.toggleSpeed=function(){B({gameSpeed:1===E.gameSpeed?2:1});var e=document.getElementById("speedBtn");e&&(2===E.gameSpeed?(e.textContent="🚀 Fast",e.classList.add("fast")):(e.textContent="🐌 Normal",e.classList.remove("fast")))},window.showCodex=function(){var e=document.getElementById("friendsCodex");if(e){e.innerHTML="";for(var t=0,n=Object.entries(x);t<n.length;t++){var a=n[t],i=a[0],r=a[1];(p=document.createElement("div")).className="codex-item";var o="",s="";r.strong.length>0&&(o=r.strong.map(function(e){return'<span style="color: #4CAF50;">'.concat(v[e].icon,"</span>")}).join(" ")),r.weak.length>0&&(s=r.weak.map(function(e){return'<span style="color: #F44336;">'.concat(v[e].icon,"</span>")}).join(" ")),p.innerHTML='\n                <div class="codex-icon" style="background-color: '.concat(r.color,';">').concat(i.charAt(0).toUpperCase(),"</div>\n                <div>\n                    <strong>").concat(i.charAt(0).toUpperCase()+i.slice(1),"</strong> (").concat(r.cost,"🍃)<br>\n                    <small>").concat(r.desc,"</small><br>\n                    <small><strong>Strong vs:</strong> ").concat(o||"None","</small><br>\n                    <small><strong>Weak vs:</strong> ").concat(s||"None","</small>\n                </div>\n            "),e.appendChild(p)}}var l=document.getElementById("enemiesCodex");if(l){l.innerHTML="";for(var c=0,d=Object.entries(v);c<d.length;c++){var p,h=d[c];i=h[0],r=h[1],(p=document.createElement("div")).className="codex-item";for(var g=[],m=[],u=0,f=Object.entries(x);u<f.length;u++){var y=f[u],w=y[0],b=y[1];b.strong.includes(i)&&g.push('<span style="color: '.concat(b.color,';">').concat(w.charAt(0).toUpperCase(),"</span>")),b.weak.includes(i)&&m.push('<span style="color: '.concat(b.color,';">').concat(w.charAt(0).toUpperCase(),"</span>"))}p.innerHTML='\n                <div class="codex-icon" style="background-color: '.concat(r.color,';">').concat(r.icon,"</div>\n                <div>\n                    <strong>").concat(r.name,"</strong> (").concat(r.socialDamage," social damage)<br>\n                    <small>").concat(r.desc,"</small><br>\n                    <small><strong>Reward:</strong> ").concat(r.reward,"🍃 | <strong>Health:</strong> ").concat(r.health," | <strong>Speed:</strong> ").concat(r.speed,"x</small><br>\n                    <small><strong>Countered by:</strong> ").concat(g.join(" ")||"Anyone","</small><br>\n                    <small><strong>Resists:</strong> ").concat(m.join(" ")||"None","</small>\n                </div>\n            "),l.appendChild(p)}}var M=document.getElementById("codexModal");M&&(M.style.display="flex")},window.closeCodex=O,window.startWaveFromModal=function(){var e=document.getElementById("waveModal");e&&(e.style.display="none"),B({waveActive:!0,enemiesSpawned:0});var t=Math.min(E.wave-1,w.length-1),n=w[t],a=n.count;B({enemiesRemaining:Math.floor(a*Math.pow(1.1,E.wave-1))});var i=Math.max(800,1800-50*E.wave)/E.gameSpeed,r=setInterval(function(){if(E.enemiesSpawned>=E.enemiesRemaining||E.gameOver)clearInterval(r);else{var e=n.enemies[E.enemiesSpawned%n.enemies.length];B({enemies:A(A([],E.enemies,!0),[new $(e)],!1),enemiesSpawned:E.enemiesSpawned+1})}},i);D()},window.closeUpgradeModal=P,window.applyUpgrade=U,window.startGame=function(){var e=document.getElementById("storylineModal");e&&(e.style.display="none");var t=document.querySelector(".game-container");t&&(t.style.opacity="1",t.style.pointerEvents="auto"),J()},window.showMapSelection=W,window.selectMap=j,window.startNewGame=function(){var e=document.getElementById("startGameModal");e&&(e.style.display="none"),C(),W()},window.showStorylineOnly=_,window.deleteSaveSlot=function(e,t){var n;t.stopPropagation();var a=q(e);if(a){F=e;var i=document.getElementById("deleteConfirmModal"),r=document.getElementById("deleteConfirmText");if(i&&r){var o=(null===(n=y[a.currentMap])||void 0===n?void 0:n.name)||"Unknown Map";r.innerHTML="\n            Are you sure you want to delete this save?<br><br>\n            <strong>Wave ".concat(a.wave,"</strong> • ").concat(o,"<br>\n            <small>This action cannot be undone.</small>\n        "),i.style.display="flex"}}},window.confirmDelete=function(){if(F){localStorage.removeItem("benDefense_".concat(F)),T("Save slot deleted!"),F=null;var e=document.getElementById("deleteConfirmModal");e&&(e.style.display="none"),J()}},window.cancelDelete=function(){F=null;var e=document.getElementById("deleteConfirmModal");e&&(e.style.display="none")},window.showExitConfirm=function(){var e=document.getElementById("exitConfirmModal");e&&(e.style.display="flex")},window.confirmExit=function(){I&&Y(),["waveModal","upgradeModal","codexModal","gameOverModal","deleteConfirmModal","exitConfirmModal"].forEach(function(e){var t=document.getElementById(e);t&&(t.style.display="none")}),W(),T("Progress saved!")},window.cancelExit=function(){var e=document.getElementById("exitConfirmModal");e&&(e.style.display="none")},window.backToSaveSlots=function(){var e=document.getElementById("mapSelectionModal");e&&(e.style.display="none"),I=null,C(),J()},window.startNewGameInSlot=H,window.loadSlotAndSelectMap=G,document.addEventListener("DOMContentLoaded",function(){console.log("DOM loaded, initializing game..."),k?(console.log("Canvas context initialized successfully"),k.fillStyle="#00ff41",k.fillRect(0,0,50,50),console.log("Drew test rectangle")):console.error("Failed to get canvas context"),_(),D(),ie()})})();